<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chuzis - Movie Details</title>
<style>
  body { font-family: Arial, sans-serif; background: #121212; color: #eee; margin: 0; padding: 20px; }
  .container { display: flex; flex-wrap: wrap; gap: 20px; max-width: 900px; margin: 0 auto; }
  img { border-radius: 10px; max-width: 300px; }
  .info { flex: 1; min-width: 280px; }
  h1 { margin-top: 0; }
  #trailer iframe { width: 100%; height: 300px; border: none; border-radius: 10px; margin-top: 15px; }
  a { color: #0af; text-decoration: none; }
  a:hover { text-decoration: underline; }
  #back { margin-bottom: 20px; display: block; }
</style>
</head>
<body>
<a id="back" href="index.html">‚Üê Back to Chuzis</a>
<div id="details">Loading movie details...</div>

<script>
  const token = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJlODA5MWQ0NDdlODQ3MjhlYmU0Mzc5NzI0NWNjNmY4NSIsIm5iZiI6MTc0ODAzNTQ0Mi43MDUsInN1YiI6IjY4MzBlNzcyNjQwZTA1YjQyOGI2YTlmYyIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.WoEuagI5GPkLtkM8xeY81jpNj6sS9VMRcYLuLS3xpFM';
  const IMG_BASE = 'https://image.tmdb.org/t/p/w500';
  const detailsDiv = document.getElementById('details');

  const urlParams = new URLSearchParams(window.location.search);
  const movieId = urlParams.get('id');

  if (!movieId) {
    detailsDiv.textContent = 'No movie selected.';
  } else {
    fetchMovieDetails(movieId);
  }

  async function fetchMovieDetails(id) {
    detailsDiv.textContent = 'Loading movie details...';

    try {
      const res = await fetch(`https://api.themoviedb.org/3/movie/${id}`, {
        headers: { Authorization: 'Bearer ' + token }
      });
      if (!res.ok) throw new Error('HTTP error ' + res.status);

      const movie = await res.json();

      // Fetch videos (trailers)
      const videosRes = await fetch(`https://api.themoviedb.org/3/movie/${id}/videos`, {
        headers: { Authorization: 'Bearer ' + token }
      });
      const videosData = await videosRes.json();

      // Find official trailer on YouTube
      const trailer = videosData.results.find(v => v.type === 'Trailer' && v.site === 'YouTube');

      detailsDiv.innerHTML = `
        <div class="container">
          <img src="${movie.poster_path ? IMG_BASE + movie.poster_path : 'https://via.placeholder.com/300x450?text=No+Image'}" alt="${movie.title}" />
          <div class="info">
            <h1>${movie.title} (${movie.release_date ? movie.release_date.slice(0,4) : 'N/A'})</h1>
            <p><strong>Genres:</strong> ${movie.genres.map(g => g.name).join(', ')}</p>
            <p><strong>Rating:</strong> ${movie.vote_average} / 10 (${movie.vote_count} votes)</p>
            <p><strong>Runtime:</strong> ${movie.runtime} min</p>
            <p><strong>Overview:</strong> ${movie.overview || 'No overview available.'}</p>
            ${trailer ? `<div id="trailer"><iframe src="https://www.youtube.com/embed/${trailer.key}" allowfullscreen></iframe></div>` : '<p>No trailer available.</p>'}
          </div>
        </div>
      `;
    } catch (e) {
      detailsDiv.textContent = 'Failed to load movie details.';
      console.error(e);
    }
  }
</script>
</body>
</html>
